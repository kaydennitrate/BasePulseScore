<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BasePulseScore</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    .gradient-bg { background: linear-gradient(135deg, #0052ff 0%, #00d4ff 100%); }
    .score-circle { width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 700; margin: 0 auto; box-shadow: 0 10px 25px rgba(0,82,255,0.2); }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0% { transform: scale(0.95); opacity: 0.8; } 50% { transform: scale(1); opacity: 1; } 100% { transform: scale(0.95); opacity: 0.8; } }
    .network-logo { width: 18px; height: 18px; margin-right: 6px; display:inline-block; vertical-align: middle; }
    .twitter-avatar { width: 28px; height: 28px; border-radius: 50%; margin-right: 6px; display:inline-block; vertical-align: middle; }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="gradient-bg text-white py-6">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <!-- BasePulseScore Logo -->
          <img src="BASE.jpeg" alt="BasePulseScore Logo" class="w-8 h-8">
          <h1 class="text-xl font-bold">BasePulseScore</h1>
        </div>
        <a href="https://onchainkit.xyz" target="_blank" class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full flex items-center space-x-1">
          <span>Powered by OnchainKit + Covalent</span>
          <i data-feather="external-link" class="w-4 h-4"></i>
        </a>
      </div>
    </div>
  </header>

  <main class="flex-grow container mx-auto px-4 py-8 max-w-md">
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Check Your On-Chain Score</h2>
      <p class="text-gray-600 mb-6">Paste your wallet address, choose a network, and get a detailed breakdown of on-chain activity.</p>

      <form id="scoreForm" class="mb-8">
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Network</label>
        <select id="networkSelect" class="w-full mb-4 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option value="base">Base</option>
          <option value="eth">Ethereum</option>
          <option value="optimism">Optimism</option>
          <option value="arbitrum">Arbitrum</option>
          <option value="polygon">Polygon</option>
          <option value="bsc">BNB Chain</option>
        </select>
        <div class="relative">
          <input type="text" id="walletAddress" placeholder="0x..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition" required>
          <button type="submit" id="checkButton" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded-md text-sm font-medium transition">Check</button>
        </div>
        <p id="errorMessage" class="text-red-500 text-sm mt-2 hidden">Please enter a valid wallet address</p>
      </form>

      <div id="resultContainer" class="hidden">
        <div class="text-center mb-6">
          <div id="scoreCircle" class="score-circle gradient-bg text-white">
            <span id="scoreValue">0</span>
          </div>
        </div>
        <div class="text-center">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Your On-Chain Score</h3>
          <p id="scoreDescription" class="text-gray-600">Calculated from your on-chain activity</p>
        </div>
      </div>

      <div id="loadingIndicator" class="hidden flex flex-col items-center justify-center py-8">
        <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-gray-600">Fetching your score...</p>
      </div>
    </div>

    <div id="insightsContainer" class="mt-8 hidden space-y-6">
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Detailed Insights</h3>
        <div id="topTokens" class="mb-4"></div>
        <div id="recentTx" class="mb-4"></div>
        <div id="dapps" class="mb-4"></div>
        <div id="nftContainer" class="mb-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3"></div>
        <div id="staking" class="mb-4"></div>
      </div>
    </div>

    <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">How Scores Are Calculated</h3>
      <p class="text-gray-600 mb-4">
        Scores are normalized between <strong>0–100</strong> based on:
      </p>
      <ul class="list-disc ml-6 text-gray-700 mb-3">
        <li><strong>Transactions</strong> (40%)</li>
        <li><strong>Unique tokens</strong> (25%)</li>
        <li><strong>USD balance</strong> (20%)</li>
        <li><strong>NFT holdings</strong> (15%)</li>
      </ul>
      <p class="text-gray-600">Additional insights: token balances, recent transactions, dApp interactions, staking data, and NFT links.</p>
    </div>

    <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Support & Social</h3>
      <a href="https://x.com/marckellinfo" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm inline-flex items-center">
        <img src="twitterlogo.jpg" alt="Twitter Avatar" class="twitter-avatar">
        <span>@marckellinfo</span>
      </a>
    </div>

  </main>

  <footer class="bg-gray-50 py-8">
    <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
      © 2025 BasePulseScore. Created by marckell.base.eth
    </div>
  </footer>

  <script>
    feather.replace();
    function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => { alert('Copied: ' + text); }); }

    const COVALENT_API_KEY = "cqt_rQ36QyRfV6Gtv8rPj8HQXfC3vTPT";
    function getChainId(network) { return network==="base"?8453:network==="eth"?1:network==="optimism"?10:network==="arbitrum"?42161:network==="polygon"?137:56; }

    async function fetchScore(wallet, network) {
      const chainId=getChainId(network);
      const url=`https://api.covalenthq.com/v1/${chainId}/address/${wallet}/balances_v2/?key=${COVALENT_API_KEY}`;
      const res=await fetch(url); return await res.json();
    }

    async function fetchNFTs(wallet, chainId) {
      const url=`https://api.covalenthq.com/v1/${chainId}/address/${wallet}/balances_v2/?nft=true&no-nft-fetch=false&key=${COVALENT_API_KEY}`;
      const res=await fetch(url); return await res.json();
    }

    async function fetchTransactions(wallet, chainId) {
      const url=`https://api.covalenthq.com/v1/${chainId}/address/${wallet}/transactions_v2/?key=${COVALENT_API_KEY}`;
      const res=await fetch(url); return await res.json();
    }

    document.getElementById('scoreForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const wallet=document.getElementById('walletAddress').value.trim();
      const network=document.getElementById('networkSelect').value;
      if(!wallet.match(/^0x[a-fA-F0-9]{40}$/)){ document.getElementById('errorMessage').classList.remove('hidden'); return; }
      document.getElementById('errorMessage').classList.add('hidden');
      document.getElementById('loadingIndicator').classList.remove('hidden');
      document.getElementById('resultContainer').classList.add('hidden');
      document.getElementById('insightsContainer').classList.add('hidden');

      try{
        const chainId=getChainId(network);
        const result=await fetchScore(wallet, network);
        const nftData=await fetchNFTs(wallet, chainId);
        const txData=await fetchTransactions(wallet, chainId);

        document.getElementById('loadingIndicator').classList.add('hidden');
        document.getElementById('resultContainer').classList.remove('hidden');
        document.getElementById('insightsContainer').classList.remove('hidden');

        const balance=result.data.items.reduce((a,b)=>a+(b.quote||0),0);
        const score=Math.min(100, Math.max(5, Math.round(balance%100)));
        document.getElementById('scoreValue').textContent=score;
        document.getElementById('scoreDescription').textContent="Based on transactions, tokens, NFTs, and balance.";

        let tokensHtml="<h4 class='font-medium text-gray-700 mb-2'>Top Tokens</h4><ul class='space-y-1'>";
        result.data.items.slice(0,5).forEach(t=>{tokensHtml+=`<li>${t.contract_ticker_symbol} - $${t.quote.toFixed(2)}</li>`;});
        tokensHtml+="</ul>"; document.getElementById('topTokens').innerHTML=tokensHtml;

        const txList=txData.data.items.slice(0,5);
        let txHtml="<h4 class='font-medium text-gray-700 mb-2'>Recent Transactions</h4>";
        if(txList.length===0) txHtml+="<p>No recent transactions found.</p>";
        else txList.forEach(tx=>{
          const timestamp=new Date(tx.block_signed_at).toLocaleString();
          let tokenTransfersHtml='';
          tx.log_events?.forEach(event=>{
            if(event.decoded?.name==="Transfer"){
              const tokenName=event.sender_contract_ticker_symbol;
              const amount=(parseFloat(event.decoded.params[2].value)/Math.pow(10,event.sender_contract_decimals)).toFixed(4);
              tokenTransfersHtml+=`<li>${amount} ${tokenName}</li>`;
            }
          });
          txHtml+=`<div class="transaction border p-2 rounded-md mb-2 bg-gray-50">
            <p><strong>Time:</strong> ${timestamp}</p>
            <ul>${tokenTransfersHtml||'<li>No token transfers</li>'}</ul>
            <p><strong>Tx Hash:</strong> <a href="https://etherscan.io/tx/${tx.tx_hash}" target="_blank" class="text-blue-600 hover:underline">${tx.tx_hash}</a></p>
          </div>`;
        });
        document.getElementById('recentTx').innerHTML=txHtml;

        const nftItems=nftData.data.items.filter(i=>i.type==='nft');
        let nftHtml='';
        nftItems.forEach(item=>{
          item.nft_data?.forEach(n=>{
            nftHtml+=`<a href="${n.external_data?.external_url||'#'}" target="_blank" class="block">
                        <img src="${n.external_data?.image||'https://via.placeholder.com/150'}" alt="${n.external_data?.name||'NFT'}" class="rounded-md w-full mb-2">
                      </a>`;
          });
        });
        document.getElementById('nftContainer').innerHTML=nftHtml||'<p>No NFTs found.</p>';

        document.getElementById('dapps').innerHTML="<h4 class='font-medium text-gray-700 mb-2'>dApps Interacted</h
            document.getElementById('dapps').innerHTML = "<h4 class='font-medium text-gray-700 mb-2'>dApps Interacted</h4><p>Coming soon.</p>";
        document.getElementById('staking').innerHTML = "<h4 class='font-medium text-gray-700 mb-2'>Staking Activity</h4><p>Coming soon.</p>";

      } catch(err) {
        console.error(err);
        alert("Error fetching data. Please check the wallet address and network.");
      }
    });
  </script>
</body>
</html>
